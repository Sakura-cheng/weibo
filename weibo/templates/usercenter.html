{% extends "base.html" %}

{% block title %}微博{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript" src="../static/js/jquery.js"></script>
<link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>
<script type=text/javascript>
  $(function() {
    $('#user_f').bind('click', function() {
    	var mark = $('#user_f').text();
    	if (mark == '关注'){
    		$.getJSON($SCRIPT_ROOT + '/follow/{{ user.username }}', 
            function(data) {
                $("#user_f").text(data.result);
      });
    	}
    	else{
    		$.getJSON($SCRIPT_ROOT + '/unfollow/{{ user.username }}', 
            function(data) {
                $("#user_f").text(data.result);
      });
    	}

      return false;
    });

    if ({{ func }}==1) {

    	$('#myDDD li:eq(2) a').tab('show');

    	 $("#myDDD a:last").on("click",function(){
            var num = $(this).index();
            $("#nav-tabs li").eq(num).tab("show");
        });
    }
  });
</script>

{% endblock %}

	{% block content %}
	<div class="container">
	<div class="col-md-2"></div>
	<div class="col-md-8">
	<div>
		<h1>{{ user.username }}
		<!-- {% if current_user.is_following(user) %}
		<button id="user_f">取关</button>
		{% else %}
		<button id="user_f">关注</button>
		{% endif %} -->
		{% if current_user.is_authenticated %}
		            {% if current_user != user %}
		                {% if current_user.is_following(user) %}
		                    <a href="/unfollow/{{ user.username }}"><button type="button" class="btn btn-primary" id="user_f">取关</button></a>
		                {% else %}
		                    <a href="/follow/{{ user.username }}"><button type="button" class="btn btn-primary" id="user_f">关注</button></a>
		                {% endif %}
		            {% endif %}
		        {% else %}
		            <a href="/follow/{{ user.username }}"><button type="button" class="btn btn-primary" id="user_f">关注</button></a>
		        {% endif %}
		</h1>
		<div>
			粉丝：<span class="badge">{{ user.followers.count() }}</span>
			关注：<span class="badge">{{ user.followeds.count() }}</span>
			微博：<span class="badge">{{ total }}</span>
			<div>
				<br>
			</div>
		</div>
		<ul class="nav nav-tabs" id="myDDD">
            <li role="presentation" class="active" id="n-"><a href="#articles" data-toggle="tab">微博</a></li>
            <li role="presentation"><a href="#followers" data-toggle="tab">粉丝</a></li>
            <li role="presentation" id="n+"><a href="#followeds" data-toggle="tab">关注</a></li>
        </ul>
        <div class="tab-content">
        	<div class="tab-pane fade in active" id="articles">
				{% for article in articles %}
				<div class="list-group">
				    <div class="list-group-item">
				        <p>{{ article.user.username }}：</p>
			            <p>&nbsp;&nbsp;&nbsp;&nbsp;{{ article.content }}</p>
			            <p class="text-right" style="color: gray">{{ moment(article.timestamp).format('HH:mm:ss YYYY/MM/DD') }}</p>
				    </div>
				</div>
				{% endfor %}
        	</div>
        	<div class="tab-pane fade" id="followers">
				{% for follower in user.followers %}
				<div class="list-group">
				    <div class="list-group-item">
				        <p><a href="/{{ follower.follower.username }}">{{ follower.follower.username }}</a>
				        
				        </p>
				    </div>
				</div>
				{% endfor %}        		
        	</div>
        	<div class="tab-pane fade" id="followeds">
				{% for followed in user.followeds %}
				<div class="list-group">
				    <div class="list-group-item">
				        <p><a href="/{{ followed.followed.username }}">{{ followed.followed.username }}</a>
				        {% if current_user.is_following(followed.followed)%}
				            <a href="/unfollow_/{{ followed.followed.username }}" style="float: right;"><button type="button" class="btn btn-primary" id="n">取关</button></a>
				        {% endif %}
				        </p>
				    </div>
				</div>
				{% endfor %}
        	</div>
        </div>
	</div>
	</div>
    <div class="col-md-2">
        <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix">   
        <a class="back-to-top" href="#top" style="position: fixed; right: 250px; bottom: 20px;">
          返回顶部
        </a>
      </nav>
    </div>  
	</div>
	{% endblock %}

<script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.min.js"></script>